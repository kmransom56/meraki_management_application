<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Vendor Network Topology</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --fortinet-red: #d43527;
            --fortinet-blue: #0066cc;
            --fortinet-green: #28a745;
            --fortinet-orange: #fd7e14;
        }

        body {
            font-family: 'Lato', sans-serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            margin: 0;
            padding: 0;
        }

        .topology-header {
            background: linear-gradient(135deg, var(--fortinet-blue), #0052a3);
            color: white;
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .topology-container {
            position: relative;
            width: 100%;
            height: calc(100vh - 80px);
            background: #ffffff;
            border-radius: 8px;
            margin: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .vendor-section {
            margin: 20px;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .meraki-section { background: linear-gradient(135deg, #28a745, #1e7e34); }
        .fortigate-section { background: linear-gradient(135deg, #d43527, #b02e20); }
        .cisco-section { background: linear-gradient(135deg, #0066cc, #0052a3); }

        .section-title {
            color: white;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .device-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .device-card {
            background: rgba(255,255,255,0.95);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .device-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .loading-spinner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
        }
    </style>
</head>

<body>
    <div class="topology-header">
        <h4 class="mb-0">
            <i class="fas fa-network-wired me-2"></i>
            Multi-Vendor Network Topology
        </h4>
    </div>

    <div class="topology-container">
        <div class="loading-spinner" id="loadingSpinner">
            <div class="spinner-border text-primary" role="status"></div>
            <div class="mt-2">Loading Multi-Vendor Topology...</div>
        </div>

        <div id="topologyContent" style="display: none;">
            <!-- Meraki Section -->
            <div class="vendor-section meraki-section">
                <div class="section-title">
                    <i class="fas fa-wifi"></i> Cisco Meraki Infrastructure
                </div>
                <div class="device-grid" id="merakiDevices">
                    <!-- Meraki devices will be loaded here -->
                </div>
            </div>

            <!-- FortiGate Section -->
            <div class="vendor-section fortigate-section">
                <div class="section-title">
                    <i class="fas fa-shield-alt"></i> Fortinet Infrastructure
                </div>
                <div class="device-grid" id="fortigateDevices">
                    <!-- FortiGate devices will be loaded here -->
                </div>
            </div>

            <!-- Other Vendors Section -->
            <div class="vendor-section cisco-section">
                <div class="section-title">
                    <i class="fas fa-server"></i> Other Network Infrastructure
                </div>
                <div class="device-grid" id="otherDevices">
                    <!-- Other vendor devices will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        class MultiVendorTopology {
            constructor() {
                this.devices = [];
                this.init();
            }

            async init() {
                try {
                    await this.loadData();
                    this.renderTopology();
                    this.hideLoading();
                } catch (error) {
                    console.error('Error initializing multi-vendor topology:', error);
                    this.showError('Failed to load multi-vendor topology data');
                }
            }

            async loadData() {
                try {
                    // Load devices from multiple sources
                    const [merakiResponse, fortigateResponse] = await Promise.all([
                        fetch('/api/devices').catch(() => ({ ok: false })),
                        fetch('/api/fortimanager/devices/all').catch(() => ({ ok: false }))
                    ]);

                    const devices = [];

                    // Process Meraki devices
                    if (merakiResponse.ok) {
                        const merakiData = await merakiResponse.json();
                        if (merakiData.devices) {
                            devices.push(...merakiData.devices.map(d => ({
                                ...d,
                                vendor: 'Meraki',
                                category: 'meraki'
                            })));
                        }
                    }

                    // Process FortiGate devices
                    if (fortigateResponse.ok) {
                        const fortigateData = await fortigateResponse.json();
                        if (fortigateData.devices) {
                            devices.push(...fortigateData.devices.map(d => ({
                                ...d,
                                vendor: 'Fortinet',
                                category: 'fortigate'
                            })));
                        }
                    }

                    this.devices = devices;
                } catch (error) {
                    console.error('Error loading multi-vendor data:', error);
                    this.devices = this.getDemoData();
                }
            }

            renderTopology() {
                const merakiContainer = document.getElementById('merakiDevices');
                const fortigateContainer = document.getElementById('fortigateDevices');
                const otherContainer = document.getElementById('otherDevices');

                // Group devices by vendor
                const devicesByVendor = this.devices.reduce((acc, device) => {
                    const vendor = device.vendor || 'Other';
                    if (!acc[vendor]) acc[vendor] = [];
                    acc[vendor].push(device);
                    return acc;
                }, {});

                // Render Meraki devices
                if (devicesByVendor.Meraki) {
                    merakiContainer.innerHTML = devicesByVendor.Meraki.map(device => 
                        this.createDeviceCard(device)
                    ).join('');
                } else {
                    merakiContainer.innerHTML = '<div class="device-card"><p>No Meraki devices found</p></div>';
                }

                // Render FortiGate devices
                if (devicesByVendor.Fortinet) {
                    fortigateContainer.innerHTML = devicesByVendor.Fortinet.map(device => 
                        this.createDeviceCard(device)
                    ).join('');
                } else {
                    fortigateContainer.innerHTML = '<div class="device-card"><p>No Fortinet devices found</p></div>';
                }

                // Render other vendor devices
                const otherVendors = Object.keys(devicesByVendor).filter(v => !['Meraki', 'Fortinet'].includes(v));
                if (otherVendors.length > 0) {
                    const otherDevices = otherVendors.flatMap(vendor => devicesByVendor[vendor]);
                    otherContainer.innerHTML = otherDevices.map(device => 
                        this.createDeviceCard(device)
                    ).join('');
                } else {
                    otherContainer.innerHTML = '<div class="device-card"><p>No other vendor devices found</p></div>';
                }
            }

            createDeviceCard(device) {
                const statusClass = device.status === 'online' ? 'success' : 
                                  device.status === 'offline' ? 'danger' : 'warning';
                
                return `
                    <div class="device-card">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h6 class="mb-0">${device.name || device.hostname || 'Unknown Device'}</h6>
                            <span class="badge bg-${statusClass}">${device.status || 'unknown'}</span>
                        </div>
                        <p class="text-muted small mb-1">
                            <i class="fas fa-server"></i> ${device.model || device.platform || 'Unknown Model'}
                        </p>
                        <p class="text-muted small mb-1">
                            <i class="fas fa-network-wired"></i> ${device.ip || 'No IP'}
                        </p>
                        <p class="text-muted small mb-0">
                            <i class="fas fa-tag"></i> ${device.vendor || 'Unknown Vendor'}
                        </p>
                    </div>
                `;
            }

            getDemoData() {
                return [
                    { name: 'Demo Meraki Switch', vendor: 'Meraki', status: 'online', model: 'MS220-8', ip: '192.168.1.10' },
                    { name: 'Demo FortiGate', vendor: 'Fortinet', status: 'online', model: 'FortiGate-60F', ip: '192.168.1.1' },
                    { name: 'Demo Access Point', vendor: 'Meraki', status: 'online', model: 'MR36', ip: '192.168.1.20' }
                ];
            }

            hideLoading() {
                document.getElementById('loadingSpinner').style.display = 'none';
                document.getElementById('topologyContent').style.display = 'block';
            }

            showError(message) {
                document.getElementById('loadingSpinner').innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle"></i> ${message}
                    </div>
                `;
            }
        }

        // Initialize topology when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new MultiVendorTopology();
        });
    </script>
</body>
</html>
