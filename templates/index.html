<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Network Management Platform</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --background-color: #ecf0f1;
            --card-background: #ffffff;
            --text-color: #2c3e50;
            --border-color: #bdc3c7;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Lato', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2rem 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 300;
            margin-bottom: 0.5rem;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .status-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .status-card {
            background: var(--card-background);
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .status-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .status-card .icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--secondary-color);
        }

        .status-card h3 {
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }

        .status-card p {
            color: #7f8c8d;
            font-size: 0.95rem;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .feature-card {
            background: var(--card-background);
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-3px);
        }

        .feature-card .feature-icon {
            font-size: 3rem;
            color: var(--secondary-color);
            margin-bottom: 1rem;
        }

        .feature-card h3 {
            font-size: 1.4rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .feature-card ul {
            list-style: none;
            padding-left: 0;
        }

        .feature-card li {
            padding: 0.3rem 0;
            color: #7f8c8d;
        }

        .feature-card li:before {
            content: "âœ“";
            color: var(--success-color);
            font-weight: bold;
            margin-right: 0.5rem;
        }

        .quick-actions {
            background: var(--card-background);
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .quick-actions h2 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
        }

        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
        }

        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: 500;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--secondary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: #229954;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background: #e67e22;
            transform: translateY(-2px);
        }

        .footer {
            background: var(--primary-color);
            color: white;
            text-align: center;
            padding: 2rem 0;
            margin-top: 3rem;
        }

        .footer p {
            opacity: 0.8;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .container {
                padding: 1rem;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><i class="fas fa-network-wired"></i> Professional Network Management Platform</h1>
        <p>Comprehensive Multi-Vendor Network Topology & Device Management</p>
        {% if qsr_mode %}
        <p><i class="fas fa-utensils"></i> QSR Mode: {{ location_name }}</p>
        {% endif %}
    </div>

    <div class="container">
        <div class="status-cards">
            <div class="status-card">
                <div class="icon">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <h3>Security & Encryption</h3>
                <p>API keys encrypted, session management active, secure credential storage</p>
            </div>
            
            <div class="status-card">
                <div class="icon">
                    <i class="fas fa-sync-alt"></i>
                </div>
                <h3>Cache-Busting Active</h3>
                <p>Real-time updates, template auto-reload, development-optimized</p>
            </div>
            
            <div class="status-card">
                <div class="icon">
                    <i class="fas fa-microchip"></i>
                </div>
                <h3>Multi-Vendor Support</h3>
                <p>Meraki, FortiGate, QSR device classification, comprehensive integration</p>
            </div>
            
            <div class="status-card" id="ai-maintenance-card">
                <div class="icon">
                    <i class="fas fa-robot" id="ai-icon"></i>
                </div>
                <h3>AI Maintenance Engine</h3>
                <p id="ai-status">Loading...</p>
                <div id="ai-metrics" style="font-size: 0.9em; margin-top: 0.5rem; opacity: 0.8;">
                    <div>Active Issues: <span id="active-issues">-</span></div>
                    <div>Success Rate: <span id="success-rate">-</span></div>
                </div>
            </div>
        </div>

        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-sitemap"></i>
                </div>
                <h3>Network Topology Visualization</h3>
                <ul>
                    <li>Enhanced device icons (30px radius)</li>
                    <li>VLAN information display</li>
                    <li>Real-time connection mapping</li>
                    <li>FortiGate-inspired professional UI</li>
                    <li>QSR restaurant device classification</li>
                </ul>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-server"></i>
                </div>
                <h3>Device Management</h3>
                <ul>
                    <li>Comprehensive device inventory</li>
                    <li>Live monitoring and status</li>
                    <li>Multi-vendor device support</li>
                    <li>Detailed device information</li>
                    <li>Performance analytics</li>
                </ul>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-tools"></i>
                </div>
                <h3>Professional Tools</h3>
                <ul>
                    <li>Network diagnostic tools</li>
                    <li>Live tool execution</li>
                    <li>Speed and throughput testing</li>
                    <li>ARP and MAC table analysis</li>
                    <li>Ping and routing diagnostics</li>
                </ul>
            </div>
        </div>

        <div class="quick-actions">
            <h2><i class="fas fa-rocket"></i> Quick Actions</h2>
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="loadNetworks()">
                    <i class="fas fa-sitemap"></i> View Networks
                </button>
                <button class="btn btn-success" onclick="window.location.href='/demo/visualization'">
                    <i class="fas fa-star"></i> Demo Enhanced Features
                </button>
                <button class="btn btn-warning" onclick="window.location.href='/fortimanager/config'">
                    <i class="fas fa-server"></i> FortiManager Config
                </button>
                <a href="/ai_maintenance" class="btn btn-success">
                    <i class="fas fa-robot"></i>
                    AI Maintenance
                </a>
                <a href="/settings" class="btn btn-warning">
                    <i class="fas fa-cog"></i>
                    Settings
                </a>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>&copy; 2025 Professional Network Management Platform | Enterprise-Grade Multi-Vendor Solution</p>
        <p>Cache-bust timestamp: {{ timestamp }}</p>
    </div>

    <script>
        // Professional-grade JavaScript functionality
        function loadNetworks() {
            // Show loading indicator
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading Networks...';
            btn.disabled = true;
            
            // First check if API key is configured by testing organizations endpoint
            fetch('/api/organizations')
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        // API key not configured
                        showApiKeyRequiredModal();
                    } else if (data.organizations && data.organizations.length > 0) {
                        // API key is working, show network selection modal
                        showNetworkSelectionModal(data.organizations);
                    } else {
                        alert('No organizations found. Please check your API key configuration in Settings.');
                    }
                })
                .catch(error => {
                    console.error('Error loading networks:', error);
                    showApiKeyRequiredModal();
                })
                .finally(() => {
                    // Restore button
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                });
        }
        
        function showApiKeyRequiredModal() {
            // Create modal for API key configuration
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); display: flex; align-items: center;
                justify-content: center; z-index: 1000;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: white; padding: 2rem; border-radius: 8px;
                max-width: 500px; width: 90%; text-align: center;
            `;
            
            content.innerHTML = `
                <h2><i class="fas fa-key" style="color: var(--warning-color);"></i> API Key Required</h2>
                <p style="margin: 1rem 0; color: #666;">You need to configure your Meraki API key before viewing networks.</p>
                <div style="margin: 1.5rem 0;">
                    <input type="password" id="quickApiKey" placeholder="Enter your Meraki API key" 
                           style="width: 100%; padding: 0.8rem; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 1rem;">
                    <div style="display: flex; gap: 1rem; justify-content: center;">
                        <button onclick="quickSetApiKey()" class="btn btn-primary">
                            <i class="fas fa-check"></i> Set API Key
                        </button>
                        <button onclick="window.location.href='/settings'" class="btn btn-secondary">
                            <i class="fas fa-cog"></i> Go to Settings
                        </button>
                        <a href="/demo/visualization" class="btn btn-info btn-sm">
                            <i class="fas fa-eye"></i> Demo Visualization
                        </a>
                        <a href="/fortimanager/config" class="btn btn-warning btn-sm">
                            <i class="fas fa-server"></i> FortiManager Config
                        </a>
                        <button onclick="closeModal()" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </div>
            `;
            
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            // Focus on input
            setTimeout(() => document.getElementById('quickApiKey').focus(), 100);
            
            // Add close function to window
            window.closeModal = () => document.body.removeChild(modal);
        }
        
        function quickSetApiKey() {
            const apiKey = document.getElementById('quickApiKey').value.trim();
            if (!apiKey) {
                alert('Please enter your API key');
                return;
            }
            
            // Show loading
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Validating...';
            btn.disabled = true;
            
            // Validate API key
            fetch('/api/validate_key', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    api_key: apiKey,
                    api_mode: 'custom'
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // API key validated, close modal and reload networks
                    closeModal();
                    setTimeout(() => loadNetworks(), 500);
                } else {
                    alert('Invalid API key: ' + (data.error || 'Please check your key and try again'));
                }
            })
            .catch(error => {
                console.error('API key validation error:', error);
                alert('Error validating API key. Please try again.');
            })
            .finally(() => {
                btn.innerHTML = originalText;
                btn.disabled = false;
            });
        }
        
        function showNetworkSelectionModal(organizations) {
            // Create modal for network selection
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); display: flex; align-items: center;
                justify-content: center; z-index: 1000;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: white; padding: 2rem; border-radius: 8px;
                max-width: 600px; width: 90%; max-height: 80%; overflow-y: auto;
            `;
            
            let html = '<h2><i class="fas fa-network-wired"></i> Select Network</h2>';
            
            organizations.forEach(org => {
                html += `<div style="margin: 1rem 0; padding: 1rem; border: 1px solid #ddd; border-radius: 4px;">`;
                html += `<h3>${org.name}</h3>`;
                html += `<button class="btn btn-primary org-networks-btn" data-org-id="${org.id}" data-org-name="${org.name}" style="margin: 0.5rem 0;">View Networks</button>`;
                html += `</div>`;
            });
            
            html += '<button onclick="closeModal()" class="btn btn-secondary" style="margin-top: 1rem;">Close</button>';
            content.innerHTML = html;
            
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            // Add close function to window
            window.closeModal = () => document.body.removeChild(modal);
            
            // Add event listeners for org network buttons
            content.addEventListener('click', function(e) {
                if (e.target.classList.contains('org-networks-btn')) {
                    const orgId = e.target.getAttribute('data-org-id');
                    const orgName = e.target.getAttribute('data-org-name');
                    loadOrgNetworks(orgId, orgName);
                }
            });
        }
        
        function loadOrgNetworks(orgId, orgName) {
            console.log('Loading networks for organization:', orgName, orgId);
            
            // Show loading in the modal
            const modal = document.querySelector('div[style*="position: fixed"]');
            if (modal) {
                const content = modal.querySelector('div[style*="background: white"]');
                content.innerHTML = `
                    <h2><i class="fas fa-network-wired"></i> Networks in ${orgName}</h2>
                    <div style="text-align: center; padding: 2rem;">
                        <div style="border: 4px solid #f3f3f3; border-top: 4px solid var(--secondary-color); border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 0 auto 1rem;"></div>
                        <p>Loading networks...</p>
                    </div>
                `;
            }
            
            // Fetch networks for this organization
            fetch(`/api/networks/${orgId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.networks && data.networks.length > 0) {
                        showNetworksList(orgName, data.networks);
                    } else {
                        showNetworksError(`No networks found in ${orgName}`);
                    }
                })
                .catch(error => {
                    console.error('Error loading networks:', error);
                    showNetworksError(`Error loading networks for ${orgName}. Please check your API configuration.`);
                });
        }
        
        function showNetworksList(orgName, networks) {
            const modal = document.querySelector('div[style*="position: fixed"]');
            if (modal) {
                const content = modal.querySelector('div[style*="background: white"]');
                let html = `<h2><i class="fas fa-network-wired"></i> Networks in ${orgName}</h2>`;
                
                html += '<div style="max-height: 400px; overflow-y: auto; margin: 1rem 0;">';
                
                networks.forEach(network => {
                    html += `
                        <div style="margin: 1rem 0; padding: 1rem; border: 1px solid #ddd; border-radius: 4px; background: #f8f9fa;">
                            <h4><i class="fas fa-sitemap"></i> ${network.name}</h4>
                            <p style="color: #666; margin: 0.5rem 0;">ID: ${network.id}</p>
                            <p style="color: #666; margin: 0.5rem 0;">Products: ${network.productTypes ? network.productTypes.join(', ') : 'Unknown'}</p>
                            <div style="margin-top: 1rem;">
                                <button onclick="viewTopology('${network.id}', '${network.name}')" class="btn btn-primary" style="margin-right: 0.5rem;">
                                    <i class="fas fa-eye"></i> View Topology
                                </button>
                                <button onclick="viewDevices('${network.id}', '${network.name}')" class="btn btn-success">
                                    <i class="fas fa-server"></i> View Devices
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                html += '<button onclick="closeModal()" class="btn btn-secondary" style="margin-top: 1rem;">Close</button>';
                content.innerHTML = html;
            }
        }
        
        function showNetworksError(message) {
            const modal = document.querySelector('div[style*="position: fixed"]');
            if (modal) {
                const content = modal.querySelector('div[style*="background: white"]');
                content.innerHTML = `
                    <h2><i class="fas fa-exclamation-triangle"></i> Error</h2>
                    <div style="padding: 1rem; background: #f8d7da; color: #721c24; border-radius: 4px; margin: 1rem 0;">
                        ${message}
                    </div>
                    <button onclick="closeModal()" class="btn btn-secondary">Close</button>
                `;
            }
        }
        
        function viewTopology(networkId, networkName) {
            console.log('Viewing topology for:', networkName, networkId);
            window.location.href = `/visualization/${networkId}`;
        }
        
        function viewDevices(networkId, networkName) {
            console.log('Viewing devices for:', networkName, networkId);
            window.location.href = `/device_inventory/${networkId}`;
        }

        // Load AI Maintenance Engine status
        function loadAIMaintenanceStatus() {
            fetch('/api/ai_maintenance/metrics')
                .then(response => response.json())
                .then(data => {
                    const statusElement = document.getElementById('ai-status');
                    const iconElement = document.getElementById('ai-icon');
                    const activeIssuesElement = document.getElementById('active-issues');
                    const successRateElement = document.getElementById('success-rate');
                    const cardElement = document.getElementById('ai-maintenance-card');
                    
                    if (data.status === 'online') {
                        statusElement.textContent = 'Online - Monitoring Active';
                        statusElement.style.color = '#28a745';
                        iconElement.style.color = '#28a745';
                        cardElement.style.borderLeft = '4px solid #28a745';
                    } else if (data.status === 'offline') {
                        statusElement.textContent = 'Offline - Not Monitoring';
                        statusElement.style.color = '#dc3545';
                        iconElement.style.color = '#dc3545';
                        cardElement.style.borderLeft = '4px solid #dc3545';
                    } else {
                        statusElement.textContent = 'Error - Check Logs';
                        statusElement.style.color = '#ffc107';
                        iconElement.style.color = '#ffc107';
                        cardElement.style.borderLeft = '4px solid #ffc107';
                    }
                    
                    activeIssuesElement.textContent = data.active_issues;
                    successRateElement.textContent = data.auto_fix_success_rate;
                })
                .catch(error => {
                    console.error('Error loading AI maintenance status:', error);
                    const statusElement = document.getElementById('ai-status');
                    const iconElement = document.getElementById('ai-icon');
                    const cardElement = document.getElementById('ai-maintenance-card');
                    
                    statusElement.textContent = 'Connection Error';
                    statusElement.style.color = '#dc3545';
                    iconElement.style.color = '#dc3545';
                    cardElement.style.borderLeft = '4px solid #dc3545';
                    
                    document.getElementById('active-issues').textContent = 'Error';
                    document.getElementById('success-rate').textContent = 'Error';
                });
        }

        // Add professional loading animations and interactions
        document.addEventListener('DOMContentLoaded', function() {
            // Load AI maintenance status immediately
            loadAIMaintenanceStatus();
            
            // Refresh AI maintenance status every 30 seconds
            setInterval(loadAIMaintenanceStatus, 30000);
            
            // Animate cards on load
            const cards = document.querySelectorAll('.status-card, .feature-card');
            cards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 100);
            });
        });

        // Cache-busting: Force reload if timestamp changes
        const currentTimestamp = Date.now();
        console.log('Professional Network Management Platform loaded at:', new Date(currentTimestamp));
    </script>
</body>
</html>
